<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Mukta"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Paytone+One&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="/styles/analytics-monthly.css" />
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.6/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
      dayjs.locale('en');

    </script>
    <script src="/scripts/busTimes.js"></script>
    <script src="/scripts/charts.js" type="text/javascript" defer></script>
    
    <style>
      /* width */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

/* Track */
::-webkit-scrollbar-track {
  display: none;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
  background: #a69a9a; 
  border-radius: 30px;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: #555; 
}
    </style>
    <title>Document</title>
  </head>
  <body>
    <!-- <img src="public/assets/bg.jpg" /> -->
    <div class="container">
      <div id="sidebar">
        <a href="/">
          <span class="material-icons-round"> home </span>
          <h3 class="sidebar-text">Home</h3>
        </a>
        <a href="/analytics-weekly">
          <span class="material-icons-round"> insights </span>
          <h3 class="sidebar-text">Analytics</h3>
        </a>
        <a href="/drivers">
          <span class="material-icons-round"> group </span>
          <h3 class="sidebar-text">Drivers</h3>
        </a>
        <a href="/live-view">
          <span class="material-icons-round"> map </span>
          <h3 class="sidebar-text">Live View</h3>
        </a>
        <!-- <a href="/settings">
          <span class="material-icons-round"> settings </span>
          <h3 class="sidebar-text">Settings</h3>
        </a> -->

        <a href="/reports">
          <span class="material-icons-round"> report </span>
          <h3 class="sidebar-text">Reports</h3>
          <span class="report-count">2</span>
        </a>
        <a href="#">
          <span class="material-icons-round"> logout </span>
          <h3 class="sidebar-text">Logout</h3>
        </a>
      </div>
      <div class="inner-container">
        <nav>
          <div class="nav-logo">
            <p class="traka-logo-type">TraKa</p>
            <p class="traka-logo-desc">Dashboard</p>
          </div>
          <p class="nav-greeting">Hello, Traka Administrator.</p>
        </nav>

        <main>
          <div class="periods">
          <a href="/analytics-weekly"><div class="period-button-weekly">Weekly</div></a>
          <a href="/analytics-monthly"><div class="period-button-monthly">Monthly</div></a>
          <a href="/analytics-yearly"><div class="period-button-yearly">Yearly</div></a>
          </div>  
          <div id="chart_a2"></div>
        </main>
        <div id="content1">
          <h2>Today's stats</h2>
          <div id="chart1"></div></div>
        <div id="content2">
          <h2>Today's stats</h2><div id="chart2"></div></div>
        <div id="content3">
          <h2>Today's stats</h2><div id="chart3"></div></div>
        <footer>
          Group 7 - Urban Monitoring Kenneth, Fitrah, Wahyu, all rights
          reserved.&copy;
        </footer>
      </div>
    </div>
  </body>

  <script>
  // console.log("busTimes.js loaded, busTimes:", busTimes);
    const updateBusTimes = (busTimes)=> {
      const now = dayjs();
    
    const upcomingBuses = busTimes
        .map(bus => {
            console.log(`Time string for ${bus.place}: ${bus.time}`);
            const [hours, minutes] = bus.time.split(':'); // Split the time string into hours and minutes
            const busTimeParsed = now.set('hour', hours).set('minute', minutes); // Set the hour and minute components
            console.log(`Parsed time for ${bus.place}: ${busTimeParsed.format('HH:mm')}`);
            return {
                place: bus.place,
                time: busTimeParsed.isValid() ? busTimeParsed.format('HH:mm') : 'Invalid Date'
            };
        })
        .filter(bus => bus.time > now.format('HH:mm')) // Compare with current time in "HH:mm" format
        .sort((a, b) => a.time.localeCompare(b.time))
        .slice(0, 3);
      
      console.log(upcomingBuses)
      place1.innerHTML =  upcomingBuses[0].place
      time1.innerHTML =  upcomingBuses[0].time
      place2.innerHTML = upcomingBuses[1].place
      time2.innerHTML = upcomingBuses[1].time
      place3.innerHTML = upcomingBuses[2].place
      time3.innerHTML = upcomingBuses[2].time
      console.log(upcomingBuses[0].time)
      
      console.log("Upcoming buses:", upcomingBuses);
    }

    const updateClock = (busTimes) => {
      console.log(busTimes)
        const currentTime = dayjs().format('HH:mm:ss');
        console.log("Current time:", currentTime);
        document.getElementById("timeNow").textContent = currentTime;
        updateBusTimes(busTimes);
    }


    document.addEventListener("DOMContentLoaded", () => {
      console.log("DOM fully loaded and parsed");

      if (typeof busTimes !== "undefined") {
        console.log("busTimes is available:", busTimes);
      } else {
        console.error("busTimes is not defined");
      }

      setInterval(()=>updateClock(busTimes), 1000);
      updateClock(busTimes);
    });
  </script>
</body>
</html>
